{% extends "layouts/kineLayout.html" %}

{% block title %}Sesiones{% endblock %}

{% block body %}
<div class="fondo container">   
    <div class="row">
         <nav class="m-1" style="--bs-breadcrumb-divider: '>';">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{{ url_for('kinesiologo_main') }}"><i class="fa-solid fa-home"></i></a></li>
          <li class="breadcrumb-item"><a href="{{ url_for('listar_pacientes', id_kinesiologo=current_user.get_id()) }}">Pacientes</a></li>
          <li class="breadcrumb-item active"><a href="{{ url_for('listar_sesiones', id_paciente = id_paciente) }}">Sesiones</a></li>
          <li class="breadcrumb-item active">Ejercicios</li>
        </ol>
        <span class="col-md-5 justify-content-end">
            <button type="button" class="btn btn-success m-1" data-bs-toggle="modal" data-bs-target="#exampleModal">
                <i class="fa-solid fa-plus"></i>
                Registrar ejercicio
            </button>        
        </span>
    </nav>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Registro de ejercicio para la sesión {{id_sesion}} </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container col-md-12 card" style="background-color:#c5d7f2">
                        <h3 style="border-radius: 15px; background-color: #3452b3; color: #d8d8ce;" class="p-2 mt-2 display-6 fw-bold card-title bg-gradient">Registrar ejercicio:</h3>
                        <form class="card-body row justify-content-center " method="post">
                            <div class="col-md-4">
                                <div class="row m-1">
                                    <div class="form-floating mb-3 p-1">
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="serie"
                                            id="serie"
                                            placeholder=""
                                        />
                                        <label for="serie">Serie</label>
                                    </div>                                                                                                                                                                          
                                </div>
                                <div class="row m-1">
                                    <div class="form-floating mb-3 p-1">
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="repeticion"
                                            id="repeticion"
                                            placeholder=""
                                        />
                                        <label for="repeticion">Repetición</label>
                                    </div>
                                </div>
                                <div class="row m-1">
                                    <div class="form-floating mb-3 p-1">
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="peso"
                                            id="peso"
                                            placeholder=""
                                        />
                                        <label for="peso">Peso</label>
                                    </div>
                                </div>
                                <div class="row m-1">
                                    <div class="form-floating mb-3 p-1">
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="duracion"
                                            id="duracion"
                                            placeholder=""
                                        />
                                        <label for="duracion">Duración</label>
                                    </div>  
                                </div>                                
                            </div>
                            <div class="col-md-4">
                                <div class="row m-1">
                                    <div class="form-floating mb-3 p-1">
                                        <select class="form-select form-select-md" name="ejercicio" id="ejercicio">
                                            <option>Seleccione una opción</option>                                                                                    
                                            {% for i in ejercicios %}
                                            <option value="{{i.id}}">{{i.nombre}}</option>
                                            {% endfor %}
                                        </select>
                                        <label for="ejercicio" class="form-label">Ejercicio realizado</label>
                                    </div>                                    
                                </div>
                                <div class="row m-1">
                                    <div class="form-floating mb-3 p-1">
                                        <input
                                          type="text"
                                          class="form-control" name="esfuerzo_percibido" id="esfuerzo_percibido" placeholder="">
                                        <label for="esfuerzo_percibido">Esfuerzo percibido por el paciente:</label>
                                      </div>                                      
                                </div>
                                <div class="row m-1">
                                    <div class="form-control mb-3 p-1">
                                        <label for="evaluacion" class="form-label">Evaluación</label>
                                        <select class="form-select form-select-md" name="evaluacion" id="evaluacion">
                                            <option selected>Evalua esta sesión:</option>
                                            <option value="No logrado">No logrado</option>
                                            <option value="Medianamente logrado">Medianamente logrado</option>
                                            <option value="Cumple las expectativas">Cumple las expectativas</option>
                                        </select>                                    
                                    </div>
                                </div>
                                <div class="row m-1">
                                    <div class="form-floating mb-3 p-1">
                                        <input
                                          type="text"
                                          class="form-control" name="comentarios" id="comentarios" placeholder="">
                                        <label for="comentarios">Comentarios del paciente:</label>
                                      </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="row m-1">
                                    <div class="form-floating mb-3 p-1">
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="presion_cardiaca"
                                            id="presion_cardiaca"
                                            placeholder=""
                                        />
                                        <label for="presion_cardiaca">Presión cardiaca</label>
                                    </div>                                                                              
                                </div>
                                <div class="row m-1">
                                    <div class="form-floating mb-3 p-1">
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="presion_arterial"
                                            id="presion_arterial"
                                            placeholder=""
                                        />
                                        <label for="presion_arterial">Presión arterial</label>
                                    </div>
                                </div>
                                <div class="row m-1">
                                    <div class="form-floating mb-3 p-1">
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="saturacion"
                                            id="saturacion"
                                            placeholder=""
                                        />
                                        <label for="saturacion">Saturación de oxígeno</label>
                                    </div>  
                                </div>
                            </div>
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                                                                                                    
                            <br>
                            <div class="row justify-content-center">
                                <button class="btn btn-primary m-1 col-md-2" type="submit" name="submit" value="crear"><i class="fa-solid fa-calendar-plus"></i> Crear</button>
                            </div>
                            <div class="row justify-content-center">
                                <button class="btn btn-danger m-1 col-md-2" type="button" id="borrarCampos"><i class="fa-solid fa-eraser"></i> Limpiar</button>
                            </div>
                            <br>
                        </div>
                        </form>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button type="button" class="btn btn-warning" data-bs-dismiss="modal"><i class="fa-solid fa-x"></i> Cerrar</button>
                    </div>
                </div>                
            </div>            
        </div>
    </div>
    

        <div class="col-md-12">
            <div class="row">
                {% with messages = get_flashed_messages(with_categories=true) %}
                  {% if messages %}
                      <div class="align-items-center justify-content-center">
                          {% for category,message in messages %}
                              <div class="alert col-lg-12  alert-{{category}} alert-dismissible show fade" role="alert" id="alert-message">
                                  <strong>{{message}}</strong> 
                                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>                        
                              </div>    
                          {% endfor %}
                      </div>
                  {% endif %}
                {% endwith %}
            </div>
            <div class="table-responsive rounded tabla">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th class="col-md-1" scope="col">Nombre Ejercicio:</th>
                            <th class="col-md-2" scope="col">Serie:</th>
                            <th class="col-md-2" scope="col">Repeticiones:</th>
                            <th class="col-md-2" scope="col">Peso:</th>
                            <th class="col-md-2" scope="col">Duración:</th>
                            <th class="col-md-2" scope="col">Comentarios:</th>
                            <th class="col-md-2" scope="col">Esfuerzo percibido:</th>
                            <th class="col-md-2" scope="col">Evalución:</th>
                            <th class="col-md-2" scope="col">Presión cardiaca:</th>
                            <th class="col-md-2" scope="col">Presión arterial:</th>
                            <th class="col-md-2" scope="col">Saturación de oxígeno:</th>
                            <th class="col-md-3" scope="col">Acciones:</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in registros %}  
                            <tr class="scope table-primary">                
                                <td>
                                    {% for j in ejercicios %}
                                        {% if j.id == i.fk_id_ejercicio %}
                                            {{j.nombre}}
                                        {% endif %}                                        
                                    {% endfor %}                                    
                                </td>            
                                <td>{{ i.serie }}</td>
                                <td>{{ i.repeticiones }}</td>
                                <td>{{ i.peso }}</td>
                                <td>{{ i.duracion }}</td>
                                <td>{{ i.comentarios }}</td>
                                <td>{{ i.esfuerzo_percibido }}</td>
                                <td>{{ i.evaluacion }}</td>
                                <td>{{ i.presion_cardiaca }}</td>
                                <td>{{ i.presion_arterial }}</td>
                                <td>{{ i.saturacion_oxigeno }}</td>
                                <td>                                
                                    <a 
                                    data-bs-toggle="tooltip" data-bs-placement="bottom" title="Ejercicios realizados" 
                                    name="ejerciciosRealizados" 
                                    id="ejerciciosRealizados" 
                                    class="btn btn-warning m-1 p-2" 
                                    href="/ejerciciosRealizados/{{i.id}}" 
                                    role="button">
                                        <i class="fa-solid fa-list-check"></i>
                                    </a>
                                    <a 
                                    data-bs-toggle="tooltip" data-bs-placement="bottom" title="Editar" 
                                    name="editsesion" 
                                    id="editsesion" 
                                    class="btn btn-info m-1 p-2" 
                                    href="/editar_sesion/{{i.id}}" 
                                    role="button">
                                        <i class="fa-solid fa-pen-to-square"></i>
                                    </a>
                                    <a 
                                    data-bs-toggle="tooltip" data-bs-placement="bottom" title="Eliminar" 
                                    name="deletesesion" 
                                    id="deletesesion" 
                                    class="btn btn-danger m-1 p-2" 
                                    href="/eliminar_ejercicio_realizado/{{i.id}}/{{id_paciente}}/{{id_sesion}}" 
                                    role="button">
                                        <i class="fa-solid fa-trash-can"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>                        
            </div>
        </div>        
    </div>
</div>    


<script>
document.getElementById("borrarCampos").addEventListener("click", function() {
    // Selecciona los campos de entrada y establece su valor en vacío
    document.getElementById("fecha").value = "";
    document.getElementById("objetivo").value = "";
    document.getElementById("comentarios").value = "";
    document.getElementById("evaluacion").value = "";
})
</script>
{% endblock %}